<!DOCTYPE html>
<html>
<head>
<title>Signup | Royal Wedding Decor</title>

<style>
body{
    margin:0;
    font-family:"Segoe UI", Arial;
    height:100vh;
    overflow:hidden;
    background:linear-gradient(135deg,#6a1b9a,#d4af37,#f8bbd0);
    background-size:400% 400%;
    animation:gradientMove 12s ease infinite;
}

@keyframes gradientMove{
    0%{background-position:0% 50%;}
    50%{background-position:100% 50%;}
    100%{background-position:0% 50%;}
}

.overlay{
    height:100vh;
    background:rgba(0,0,0,0.45);
    display:flex;
    justify-content:center;
    align-items:center;
}

.box{
    background:rgba(235, 207, 161, 0.96);
    padding:45px;
    border-radius:20px;
    width:380px;
    text-align:center;
    box-shadow:0 18px 45px rgba(0,0,0,0.45);
}

h2{
    color:#6a1b9a;
    margin-bottom:25px;
}

input{
    width:100%;
    padding:13px;
    margin:10px 0;
    border-radius:8px;
    border:1px solid #d4af37;
    font-size:15px;
}

button{
    width:100%;
    padding:14px;
    margin-top:15px;
    background:linear-gradient(to right,#f8bbd0,#f48fb1);
    color:#6a1b9a;
    border:none;
    border-radius:8px;
    font-size:16px;
    font-weight:bold;
    cursor:pointer;
}

#otpBox{ display:none; }

.error{ color:red; font-size:14px; margin-top:8px; }
.success{ color:green; font-size:14px; margin-top:8px; }
</style>
</head>

<body>

<div class="overlay">
<div class="box">

<!-- SIGNUP -->
<div id="signupBox">
    <h2>Create Account</h2>

    <form id="signupForm">
        <input type="text" name="name" placeholder="Full Name" required>
        <input type="email" name="email" placeholder="Email Address" required>
        <input type="password" name="password" placeholder="Password" required>
        <button type="submit">Signup</button>
    </form>
</div>

<!-- OTP -->
<div id="otpBox">
    <h2>Verify OTP</h2>

    <input type="text" id="otpInput" placeholder="Enter 6 digit OTP">
    <button onclick="verifyOtp()">Verify OTP</button>

    <div id="otpMsg"></div>
</div>

</div>
</div>

<script>
let userEmail = "";

/* SIGNUP */
document.getElementById("signupForm").addEventListener("submit", function(e){
    e.preventDefault();

    const formData = new URLSearchParams(new FormData(this));
    userEmail = this.email.value;

    fetch("/signup", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: formData
    })
    .then(res => res.text())
    .then(msg => {

        if (msg === "exists") {
            window.location.href = "/login?msg=exists";
            return;
        }

        document.getElementById("signupBox").style.display="none";
        document.getElementById("otpBox").style.display="block";
    });
});

/* VERIFY OTP */
function verifyOtp(){
    const otp = document.getElementById("otpInput").value.trim();
    const box = document.getElementById("otpMsg");

    if (!otp) {
        box.innerHTML="<div class='error'>Enter OTP</div>";
        return;
    }

    fetch("/verify-otp", {
        method:"POST",
        headers:{ "Content-Type":"application/x-www-form-urlencoded" },
        body:`email=${encodeURIComponent(userEmail)}&otp=${encodeURIComponent(otp)}`
    })
    .then(res=>res.text())
    .then(msg=>{
        if(msg==="success"){
            box.innerHTML="<div class='success'>OTP Verified! Redirecting...</div>";
            setTimeout(()=>location.href="/login",1500);
        } else {
            box.innerHTML="<div class='error'>Wrong OTP</div>";
        }
    });
}
</script>

</body>
</html>
